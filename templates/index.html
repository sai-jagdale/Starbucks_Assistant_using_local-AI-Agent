<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Starbucks Assistant</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Starbucks-logo.png') }}">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700&display=swap"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      :root {
        --coffee-bg: #f3ede7;
        --coffee-container: #fcfaf8;
        --coffee-border: #e4dcd3;
        --coffee-text: #1b140e;
        --coffee-muted: #97724e;
        --coffee-brown: #a97449;
        --coffee-brown-dark: #8a5e3a;
        --coffee-user-msg: #a97449;
      }

       body {
    background-color: var(--coffee-bg);
    font-family: 'Plus Jakarta Sans', 'Segoe UI Emoji', 'Apple Color Emoji', sans-serif;
    }

      .coffee-box {
        background-color: var(--coffee-container);
      }

      .coffee-header, .coffee-footer {
        border-color: var(--coffee-border);
      }

      .coffee-title {
        color: var(--coffee-text);
      }

      .coffee-msg {
        background-color: var(--coffee-bg);
        color: var(--coffee-text);
      }

      .coffee-user {
        background-color: var(--coffee-user-msg);
        color: white;
      }

      .coffee-thinking {
        background-color: var(--coffee-bg);
        color: var(--coffee-muted);
      }

      .coffee-input {
        background-color: var(--coffee-bg);
        color: var(--coffee-text);
        border-color: var(--coffee-border);
      }

      .coffee-input::placeholder {
        color: var(--coffee-muted);
      }

      .coffee-btn {
        background-color: var(--coffee-brown);
        color: white;
      }

      .coffee-btn:hover {
        background-color: var(--coffee-brown-dark);
      }
    </style>
  </head>

  <body class="flex items-center justify-center min-h-screen px-4">
    <div class="coffee-box shadow-xl rounded-2xl w-full max-w-3xl flex flex-col min-h-[80vh]">

      
      <!-- Header -->
      <header class="coffee-header p-4 border-b flex items-center gap-3">
        <img src="{{ url_for('static', filename='Starbucks-logo.png') }}" alt="Starbucks Logo" class="w-8 h-8 rounded-full">
        <h1 class="text-lg font-bold coffee-title">Starbucks Assistant</h1>
      </header>

      <!-- Chat messages -->
      <main id="chatBox" class="flex-1 overflow-y-auto p-4 space-y-4">
        <div class="coffee-msg rounded-xl p-4 max-w-[80%]">
          Hi there! I'm your Starbucks Assistant. Ask me anything about Starbucks.
        </div>
      </main>

      <!-- Input -->
      <footer class="coffee-footer p-4 border-t">
        <div class="flex gap-2">
          <input
            id="questionInput"
            type="text"
            placeholder="Ask me anything..."
            class="coffee-input flex-1 rounded-xl px-4 py-2 outline-none border"
          />
          <button
            id="sendBtn"
            class="coffee-btn px-4 py-2 rounded-xl hover:coffee-btn flex items-center justify-center"
          >
            <!-- Arrow icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      </footer>
    </div>

    <!-- Script -->
    <script>
      const sendBtn = document.getElementById("sendBtn");
      const questionInput = document.getElementById("questionInput");
      const chatBox = document.getElementById("chatBox");

      function sendQuestion() {
        const question = questionInput.value.trim();
        if (!question) return;

        const userMsg = document.createElement("div");
        userMsg.className =
          "coffee-user rounded-xl p-4 max-w-[80%] ml-auto";
        userMsg.textContent = question;
        chatBox.appendChild(userMsg);
        chatBox.scrollTop = chatBox.scrollHeight;

        questionInput.value = "";

        const thinkingBubble = document.createElement("div");
        thinkingBubble.className =
          "coffee-thinking italic rounded-xl p-4 max-w-[80%] flex items-center gap-2";
        thinkingBubble.id = "thinkingBubble";
        thinkingBubble.innerHTML = `
          <span>â˜• Brewing your answer, it may take a few seconds </span>
          <span class="dots"></span>
        `;
        chatBox.appendChild(thinkingBubble);
        chatBox.scrollTop = chatBox.scrollHeight;

        let dotCount = 0;
        const dotsSpan = thinkingBubble.querySelector(".dots");
        const dotInterval = setInterval(() => {
          dotCount = (dotCount + 1) % 4;
          dotsSpan.textContent = ".".repeat(dotCount);
        }, 500);

        fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question }),
        })
          .then((res) => res.json())
          .then((data) => {
            clearInterval(dotInterval);
            thinkingBubble.remove();

            const botMsg = document.createElement("div");
            botMsg.className =
              "coffee-msg rounded-xl p-4 max-w-[80%]";
            botMsg.textContent = data.answer;
            chatBox.appendChild(botMsg);
            chatBox.scrollTop = chatBox.scrollHeight;
          })
          .catch((err) => {
            clearInterval(dotInterval);
            thinkingBubble.remove();
            const errorMsg = document.createElement("div");
            errorMsg.className =
              "bg-red-100 text-red-700 rounded-xl p-4 max-w-[80%]";
            errorMsg.textContent = "Something went wrong. Try again.";
            chatBox.appendChild(errorMsg);
            chatBox.scrollTop = chatBox.scrollHeight;
          });
      }

      sendBtn.addEventListener("click", sendQuestion);
      questionInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          sendQuestion();
        }
      });
    </script>
  </body>
</html>
